<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science III with python (Class notes) - 2&nbsp; Regression splines</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Assignment A.html" rel="next">
<link href="./L1_Scikit-learn.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Regression splines</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./NU_Stat_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science III with python (Class notes)</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Moving towards non-linearity</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L1_Scikit-learn.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to scikit-learn</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lec2_Regression_splines.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Regression splines</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Assignment A.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Assignment A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Stratified splitting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Stratified splitting (classification problem)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Datasets, assignment and project files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#polynomial-regression-vs-regression-splines" id="toc-polynomial-regression-vs-regression-splines" class="nav-link active" data-scroll-target="#polynomial-regression-vs-regression-splines"><span class="toc-section-number">2.1</span>  Polynomial regression vs Regression splines</a>
  <ul>
  <li><a href="#model-of-degree-1" id="toc-model-of-degree-1" class="nav-link" data-scroll-target="#model-of-degree-1"><span class="toc-section-number">2.1.1</span>  Model of degree 1</a></li>
  <li><a href="#model-of-degree-2" id="toc-model-of-degree-2" class="nav-link" data-scroll-target="#model-of-degree-2"><span class="toc-section-number">2.1.2</span>  Model of degree 2</a></li>
  <li><a href="#model-of-degree-3" id="toc-model-of-degree-3" class="nav-link" data-scroll-target="#model-of-degree-3"><span class="toc-section-number">2.1.3</span>  Model of degree 3</a></li>
  </ul></li>
  <li><a href="#regression-splines-with-knots-at-uniform-quantiles-of-data" id="toc-regression-splines-with-knots-at-uniform-quantiles-of-data" class="nav-link" data-scroll-target="#regression-splines-with-knots-at-uniform-quantiles-of-data"><span class="toc-section-number">2.2</span>  Regression splines with knots at uniform quantiles of data</a></li>
  <li><a href="#natural-cubic-splines" id="toc-natural-cubic-splines" class="nav-link" data-scroll-target="#natural-cubic-splines"><span class="toc-section-number">2.3</span>  Natural cubic splines</a></li>
  <li><a href="#generalized-additive-model-gam" id="toc-generalized-additive-model-gam" class="nav-link" data-scroll-target="#generalized-additive-model-gam"><span class="toc-section-number">2.4</span>  Generalized additive model (GAM)</a></li>
  <li><a href="#mars-multivariate-adaptive-regression-splines" id="toc-mars-multivariate-adaptive-regression-splines" class="nav-link" data-scroll-target="#mars-multivariate-adaptive-regression-splines"><span class="toc-section-number">2.5</span>  MARS (Multivariate Adaptive Regression Splines)</a>
  <ul>
  <li><a href="#mars-of-degree-1" id="toc-mars-of-degree-1" class="nav-link" data-scroll-target="#mars-of-degree-1"><span class="toc-section-number">2.5.1</span>  MARS of degree 1</a></li>
  <li><a href="#mars-of-degree-2" id="toc-mars-of-degree-2" class="nav-link" data-scroll-target="#mars-of-degree-2"><span class="toc-section-number">2.5.2</span>  MARS of degree 2</a></li>
  <li><a href="#mars-including-categorical-variables" id="toc-mars-including-categorical-variables" class="nav-link" data-scroll-target="#mars-including-categorical-variables"><span class="toc-section-number">2.5.3</span>  MARS including categorical variables</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Regression splines</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><em>Read sections 7.1-7.4 of the book before using these notes.</em></p>
<p><em>Note that in this course, lecture notes are not sufficient, you must read the book for better understanding. Lecture notes are just implementing the concepts of the book on a dataset, but not explaining the concepts elaborately.</em></p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> patsy <span class="im">import</span> dmatrix</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># install the py-earth library first: https://anaconda.org/conda-forge/sklearn-contrib-py-earth</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyearth <span class="im">import</span> Earth</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the same datasets as used for linear regression in STAT303-2, </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#so that we can compare the non-linear models with linear regression</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>trainf <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/Car_features_train.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>trainp <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/Car_prices_train.csv'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>testf <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/Car_features_test.csv'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>testp <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/Car_prices_test.csv'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> pd.merge(trainf,trainp)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.merge(testf,testp)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>carID</th>
      <th>brand</th>
      <th>model</th>
      <th>year</th>
      <th>transmission</th>
      <th>mileage</th>
      <th>fuelType</th>
      <th>tax</th>
      <th>mpg</th>
      <th>engineSize</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18473</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2020</td>
      <td>Semi-Auto</td>
      <td>11</td>
      <td>Diesel</td>
      <td>145</td>
      <td>53.3282</td>
      <td>3.0</td>
      <td>37980</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15064</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2019</td>
      <td>Semi-Auto</td>
      <td>10813</td>
      <td>Diesel</td>
      <td>145</td>
      <td>53.0430</td>
      <td>3.0</td>
      <td>33980</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18268</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2020</td>
      <td>Semi-Auto</td>
      <td>6</td>
      <td>Diesel</td>
      <td>145</td>
      <td>53.4379</td>
      <td>3.0</td>
      <td>36850</td>
    </tr>
    <tr>
      <th>3</th>
      <td>18480</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2017</td>
      <td>Semi-Auto</td>
      <td>18895</td>
      <td>Diesel</td>
      <td>145</td>
      <td>51.5140</td>
      <td>3.0</td>
      <td>25998</td>
    </tr>
    <tr>
      <th>4</th>
      <td>18492</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2015</td>
      <td>Automatic</td>
      <td>62953</td>
      <td>Diesel</td>
      <td>160</td>
      <td>51.4903</td>
      <td>3.0</td>
      <td>18990</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="polynomial-regression-vs-regression-splines" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="polynomial-regression-vs-regression-splines"><span class="header-section-number">2.1</span> Polynomial regression vs Regression splines</h2>
<section id="model-of-degree-1" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="model-of-degree-1"><span class="header-section-number">2.1.1</span> Model of degree 1</h3>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(train[<span class="st">'mileage'</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> train[<span class="st">'price'</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>lr_model <span class="op">=</span> LinearRegression()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>lr_model.fit(X, y)<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ols_object = smf.ols(formula = 'price~mileage', data = train)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#lr_model = ols_object.fit()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lr_model.coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>array([-0.32131335])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression spline of degree 1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for splines of degree 1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>transformed_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , knots=(33000,66000,100000), degree = 1, include_intercept = False)"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> trainf,return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Developing a linear regression model on the spline basis functions - this is the regression splines model</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>reg_spline_model <span class="op">=</span> LinearRegression()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>reg_spline_model.fit(transformed_x, train[<span class="st">'price'</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing polynomial model and the regression spline model of degree 1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>knots <span class="op">=</span> [<span class="dv">33000</span>,<span class="dv">66000</span>,<span class="dv">100000</span>] <span class="co">#Knots for the spline</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>d<span class="op">=</span><span class="dv">1</span> <span class="co">#Degree of predictor in the model</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Writing a function to visualize polynomial model and the regression spline model of degree d</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> viz_models():</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize <span class="op">=</span> (<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Visualizing the linear regression model</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    pred_price <span class="op">=</span> lr_model.predict(X)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot(ax <span class="op">=</span> axes[<span class="dv">0</span>],x <span class="op">=</span> <span class="st">'mileage'</span>, y <span class="op">=</span> <span class="st">'price'</span>, data <span class="op">=</span> train, color <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(ax <span class="op">=</span> axes[<span class="dv">0</span>],x <span class="op">=</span> train.mileage, y <span class="op">=</span> pred_price, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(<span class="st">'Polynomial regression model of degree '</span><span class="op">+</span><span class="bu">str</span>(d))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Visualizing the regression splines model of degree 'd'    </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>].set_title(<span class="st">'Regression splines model of degree '</span><span class="op">+</span> <span class="bu">str</span>(d))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x <span class="op">=</span> <span class="st">'mileage'</span>, y <span class="op">=</span> <span class="st">'price'</span>, data <span class="op">=</span> train, color <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>],x <span class="op">=</span> train.mileage, y <span class="op">=</span> reg_spline_model.predict(transformed_x), color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        plt.axvline(knots[i], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>viz_models()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We observe the regression splines model better fits the data as compared to the polynomial regression model. This is because regression splines of degree 1 fit piecewise polynomials, or linear models on sub-sections of the predictor, which helps better capture the trend. However, this added flexibility may also lead to overfitting. Hence, one must be careful to check for overfitting when using splines. Overfitting may be checked by k-fold cross validation or comparing test and train errors.</p>
<p>The red lines in the plot on the right denote the position of knots. Knots separate distinct splines.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for test data for prediction</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>test_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , knots=(33000,66000,100000), degree = 1, include_intercept = False)"</span>,data <span class="op">=</span> {<span class="st">'mileage'</span>:test[<span class="st">'mileage'</span>]},</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                                                                                                  return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Function to compute RMSE (root mean squared error on train and test datasets)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmse():</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Error on train data for the linear regression model</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"RMSE on train data:"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Linear regression:"</span>, np.sqrt(mean_squared_error(lr_model.predict(),train.price)))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Error on train data for the regression spline model</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Regression splines:"</span>, np.sqrt(mean_squared_error(reg_spline_model.predict(),train.price)))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Error on test data for the linear regression model</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">RMSE on test data:"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Linear regression:"</span>,np.sqrt(mean_squared_error(lr_model.predict(test),test.price)))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Error on test data for the regression spline model</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Regression splines:"</span>,np.sqrt(mean_squared_error(reg_spline_model.predict(test_x),test.price)))    </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>rmse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE on train data:
Linear regression: 14403.250083261853
Regression splines: 13859.640716531134

RMSE on test data:
Linear regression: 14370.94086395544
Regression splines: 13770.133025694666</code></pre>
</div>
</div>
</section>
<section id="model-of-degree-2" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="model-of-degree-2"><span class="header-section-number">2.1.2</span> Model of degree 2</h3>
<p>A higher degree model will lead to additional flexibility for both polynomial and regression splines models.</p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Including mileage squared as a predictor and developing the model</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ols_object <span class="op">=</span> smf.ols(formula <span class="op">=</span> <span class="st">'price~mileage+I(mileage**2)'</span>, data <span class="op">=</span> train)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>lr_model <span class="op">=</span> ols_object.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression spline of degree 2</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for splines of degree 2</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>transformed_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , knots=(33000,66000,100000), degree = 2, include_intercept = False)"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> {<span class="st">'mileage'</span>:train[<span class="st">'mileage'</span>]},return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Developing a linear regression model on the spline basis functions - this is the regression splines model</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>reg_spline_model <span class="op">=</span> sm.OLS(train[<span class="st">'price'</span>], transformed_x).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="227">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>d<span class="op">=</span><span class="dv">2</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>viz_models()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Unlike polynomial regression, splines functions avoid imposing a global structure on the non-linear function of X. This provides a better local fit to the data.</p>
<div class="cell" data-execution_count="304">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for test data for prediction</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>test_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , knots=(33000,66000,100000), degree = 2, include_intercept = False)"</span>,data <span class="op">=</span> {<span class="st">'mileage'</span>:test[<span class="st">'mileage'</span>]},</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                                                                                  return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rmse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE on train data:
Linear regression: 14403.250083261853
Regression splines: 13859.640716531134

RMSE on test data:
Linear regression: 14370.94086395544
Regression splines: 13770.133025694666</code></pre>
</div>
</div>
</section>
<section id="model-of-degree-3" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="model-of-degree-3"><span class="header-section-number">2.1.3</span> Model of degree 3</h3>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ols_object <span class="op">=</span> smf.ols(formula <span class="op">=</span> <span class="st">'price~mileage+I(mileage**2)+I(mileage**3)'</span>, data <span class="op">=</span> train)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>lr_model <span class="op">=</span> ols_object.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression spline of degree 3</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for splines of degree 3</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>transformed_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , knots=(20000,40000,80000), degree = 3, include_intercept = False)"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> {<span class="st">'mileage'</span>:train[<span class="st">'mileage'</span>]},return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Developing a linear regression model on the spline basis functions - this is the regression splines model</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>reg_spline_model <span class="op">=</span> sm.OLS(train[<span class="st">'price'</span>], transformed_x).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>transformed_x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Intercept</th>
      <th>bs(mileage, knots=(20000, 40000, 80000), degree=3, include_intercept=False)[0]</th>
      <th>bs(mileage, knots=(20000, 40000, 80000), degree=3, include_intercept=False)[1]</th>
      <th>bs(mileage, knots=(20000, 40000, 80000), degree=3, include_intercept=False)[2]</th>
      <th>bs(mileage, knots=(20000, 40000, 80000), degree=3, include_intercept=False)[3]</th>
      <th>bs(mileage, knots=(20000, 40000, 80000), degree=3, include_intercept=False)[4]</th>
      <th>bs(mileage, knots=(20000, 40000, 80000), degree=3, include_intercept=False)[5]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.001499</td>
      <td>3.749187e-07</td>
      <td>1.562637e-11</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.583162</td>
      <td>3.001491e-01</td>
      <td>1.975041e-02</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.000750</td>
      <td>9.374336e-08</td>
      <td>1.953296e-12</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.293446</td>
      <td>6.009875e-01</td>
      <td>1.053974e-01</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>2.580169e-02</td>
      <td>7.669068e-01</td>
      <td>0.200988</td>
      <td>0.006303</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4955</th>
      <td>1.0</td>
      <td>0.005441</td>
      <td>4.824519e-01</td>
      <td>5.016606e-01</td>
      <td>0.010446</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4956</th>
      <td>1.0</td>
      <td>0.206763</td>
      <td>6.438755e-01</td>
      <td>1.493551e-01</td>
      <td>0.000006</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4957</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>2.783832e-01</td>
      <td>0.496164</td>
      <td>0.213126</td>
      <td>0.012326</td>
    </tr>
    <tr>
      <th>4958</th>
      <td>1.0</td>
      <td>0.198162</td>
      <td>6.468919e-01</td>
      <td>1.549344e-01</td>
      <td>0.000012</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4959</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>2.233101e-01</td>
      <td>7.229229e-01</td>
      <td>0.053702</td>
      <td>0.000065</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>4960 rows Ã— 7 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="230">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>d<span class="op">=</span><span class="dv">3</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>knots<span class="op">=</span>[<span class="dv">20000</span>,<span class="dv">40000</span>,<span class="dv">80000</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>viz_models()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Unlike polynomial regression, splines functions avoid imposing a global structure on the non-linear function of X. This provides a better local fit to the data.</p>
<div class="cell" data-execution_count="308">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for test data for prediction</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>test_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , knots=(20000,40000,80000), degree = 3, include_intercept = False)"</span>,data <span class="op">=</span> {<span class="st">'mileage'</span>:test[<span class="st">'mileage'</span>]},</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                                                                                  return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="309">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>rmse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE on train data:
Linear regression: 13891.962447594644
Regression splines: 13792.371446327243

RMSE on test data:
Linear regression: 13789.708418357186
Regression splines: 13651.288965905529</code></pre>
</div>
</div>
</section>
</section>
<section id="regression-splines-with-knots-at-uniform-quantiles-of-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="regression-splines-with-knots-at-uniform-quantiles-of-data"><span class="header-section-number">2.2</span> Regression splines with knots at uniform quantiles of data</h2>
<p>If degrees of freedom are provided instead of knots, the knots are by default chosen at uniform quantiles of data. For example if there are 7 degrees of freedom (including the intercept), then there will be 7-4 = 3 knots. These knots will be chosen at the 255h, 50th and 75th quantiles of the data.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Regression spline of degree 3</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for splines of degree 3</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>transformed_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , df=6, degree = 3, include_intercept = False)"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> {<span class="st">'mileage'</span>:train[<span class="st">'mileage'</span>]},return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Developing a linear regression model on the spline basis functions - this is the regression splines model</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>reg_spline_model <span class="op">=</span> sm.OLS(train[<span class="st">'price'</span>], transformed_x).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="274">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>d<span class="op">=</span><span class="dv">3</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>unif_knots <span class="op">=</span> pd.qcut(train.mileage,<span class="dv">4</span>,retbins<span class="op">=</span><span class="va">True</span>)[<span class="dv">1</span>][<span class="dv">1</span>:<span class="dv">4</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>knots<span class="op">=</span>unif_knots</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>viz_models()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Splines can be unstable at the outer range of predictors. In the figure (on the right), the left-most spline may be overfitting.</p>
<div class="cell" data-execution_count="311">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for test data for prediction</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>test_x <span class="op">=</span> dmatrix(<span class="st">"bs(mileage , knots="</span> <span class="op">+</span><span class="bu">str</span>(<span class="bu">tuple</span>(unif_knots)) <span class="op">+</span> <span class="st">", degree = 3, include_intercept = False)"</span>,data <span class="op">=</span> {<span class="st">'mileage'</span>:test[<span class="st">'mileage'</span>]},</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                                                                                  return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="312">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>rmse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE on train data:
Linear regression: 13891.962447594644
Regression splines: 13781.79102252679

RMSE on test data:
Linear regression: 13789.708418357186
Regression splines: 13676.271829882426</code></pre>
</div>
</div>
</section>
<section id="natural-cubic-splines" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="natural-cubic-splines"><span class="header-section-number">2.3</span> Natural cubic splines</h2>
<p>Page 298: â€œA natural spline is a regression spline with additional boundary constraints: the function is required to be linear at the boundary (in the region where X is smaller than the smallest knot, or larger than the largest knot). This additional constraint means that natural splines generally produce more stable estimates at the boundaries.â€</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Natural cubic spline</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for the natural cubic spline</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>transformed_x <span class="op">=</span> dmatrix(<span class="st">"cr(mileage , df=4,constraints='center')"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> {<span class="st">'mileage'</span>:train[<span class="st">'mileage'</span>]},return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>reg_spline_model <span class="op">=</span> sm.GLM(train[<span class="st">'price'</span>], transformed_x).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>d<span class="op">=</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>unif_knots <span class="op">=</span> pd.qcut(train.mileage,<span class="dv">4</span>,retbins<span class="op">=</span><span class="va">True</span>)[<span class="dv">1</span>][<span class="dv">1</span>:<span class="dv">4</span>]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>knots<span class="op">=</span>unif_knots</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>viz_models()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Note that the natural cubic spline is more stable than a cubic splines with knots at uniformly distributed quantiles.</p>
<div class="cell" data-execution_count="271">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for test data for prediction</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>test_x <span class="op">=</span> dmatrix(<span class="st">"cr(mileage , knots="</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">tuple</span>(unif_knots))<span class="op">+</span><span class="st">",constraints='center')"</span>,data <span class="op">=</span> {<span class="st">'mileage'</span>:test[<span class="st">'mileage'</span>]},</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                                                                                                  return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="272">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>rmse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE on train data:
Linear regression: 13891.962447594644
Regression splines: 13805.022189679756

RMSE on test data:
Linear regression: 13789.708418357186
Regression splines: 13666.943224268975</code></pre>
</div>
</div>
</section>
<section id="generalized-additive-model-gam" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="generalized-additive-model-gam"><span class="header-section-number">2.4</span> Generalized additive model (GAM)</h2>
<p>GAM allow for flexible nonlinearities in several variables, but retain the additive structure of linear models. In a GAM, non-linear basis functions of predictors can be used as predictors of a linear regression model. For example, <span class="math display">\[y = f_1(X_1) + f_2(X_2) + \epsilon\]</span> is a GAM, where <span class="math inline">\(f_1(.)\)</span> may be a cubic spline based on the predictor <span class="math inline">\(X_1\)</span>, and <span class="math inline">\(f_2(.)\)</span> may be a step function based on the predictor <span class="math inline">\(X_2\)</span>.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sns.distplot(train.year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\akl0407\Anaconda3\lib\site-packages\seaborn\distributions.py:2557: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>&lt;AxesSubplot:xlabel='year', ylabel='Density'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-29-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#GAM</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#GAM includes cubic splines for mileage. Other predictors are year, engineSize, mpg, mileage and their interactions</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>X_transformed <span class="op">=</span> dmatrix(<span class="st">'bs(mileage,df=6,degree = 3)+year*engineSize*mpg*mileage'</span>, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> {<span class="st">'year'</span>:train[<span class="st">'year'</span>],<span class="st">'engineSize'</span>:train[<span class="st">'engineSize'</span>],<span class="st">'mpg'</span>:train[<span class="st">'mpg'</span>],<span class="st">'mileage'</span>:train[<span class="st">'mileage'</span>]} ,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                                                                            return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>model_gam <span class="op">=</span> sm.OLS(train[<span class="st">'price'</span>],X_transformed).fit()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for test data for prediction</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> dmatrix(<span class="st">'bs(mileage,df=6,degree = 3, include_intercept = False)+year*engineSize*mpg*mileage'</span>, </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> {<span class="st">'year'</span>:test[<span class="st">'year'</span>],<span class="st">'engineSize'</span>:test[<span class="st">'engineSize'</span>],<span class="st">'mpg'</span>:test[<span class="st">'mpg'</span>],<span class="st">'mileage'</span>:test[<span class="st">'mileage'</span>]} ,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                                                                            return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> model_gam.predict(X_test)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(preds,test.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>8434.756663328963</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#GAM</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#GAM includes cubic splines for mileage, year, engineSize, mpg, and interactions of all predictors</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>X_transformed <span class="op">=</span> dmatrix(<span class="st">'bs(mileage,df=6,degree = 3)+bs(mpg,df=6,degree = 3)+bs(engineSize,df=6,degree = 3)+year*engineSize*mpg*mileage'</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> {<span class="st">'year'</span>:train[<span class="st">'year'</span>],<span class="st">'engineSize'</span>:train[<span class="st">'engineSize'</span>],<span class="st">'mpg'</span>:train[<span class="st">'mpg'</span>],<span class="st">'mileage'</span>:train[<span class="st">'mileage'</span>]} ,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                                                                            return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>model_gam <span class="op">=</span> sm.OLS(train[<span class="st">'price'</span>],X_transformed).fit()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating basis functions for test data for prediction</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> dmatrix(<span class="st">'bs(mileage,df=6,degree = 3, include_intercept = False)+bs(mpg,df=6,degree = 3)+bs(engineSize,df=6,degree = 3)+year*engineSize*mpg*mileage'</span>, </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> {<span class="st">'year'</span>:test[<span class="st">'year'</span>],<span class="st">'engineSize'</span>:test[<span class="st">'engineSize'</span>],<span class="st">'mpg'</span>:test[<span class="st">'mpg'</span>],<span class="st">'mileage'</span>:test[<span class="st">'mileage'</span>]} ,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                                                                            return_type <span class="op">=</span> <span class="st">'dataframe'</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> model_gam.predict(X_test)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(preds,test.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>7997.325718841729</code></pre>
</div>
</div>
<div class="cell" data-execution_count="289">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ols_object <span class="op">=</span> smf.ols(formula <span class="op">=</span> <span class="st">'price~(year+engineSize+mileage+mpg)**2+I(mileage**2)+I(mileage**3)'</span>, data <span class="op">=</span> train)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> ols_object.fit()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="289">

<table class="simpletable">
<caption>OLS Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>          <td>price</td>      <th>  R-squared:         </th> <td>   0.704</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.703</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   1308.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Sun, 27 Mar 2022</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>01:08:50</td>     <th>  Log-Likelihood:    </th> <td> -52157.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  4960</td>      <th>  AIC:               </th> <td>1.043e+05</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  4950</td>      <th>  BIC:               </th> <td>1.044e+05</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     9</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
           <td></td>             <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P&gt;|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>          <td>   -0.0009</td> <td>    0.000</td> <td>   -2.752</td> <td> 0.006</td> <td>   -0.002</td> <td>   -0.000</td>
</tr>
<tr>
  <th>year</th>               <td>   -1.1470</td> <td>    0.664</td> <td>   -1.728</td> <td> 0.084</td> <td>   -2.448</td> <td>    0.154</td>
</tr>
<tr>
  <th>engineSize</th>         <td>    0.0052</td> <td>    0.000</td> <td>   17.419</td> <td> 0.000</td> <td>    0.005</td> <td>    0.006</td>
</tr>
<tr>
  <th>mileage</th>            <td>  -31.4751</td> <td>    2.621</td> <td>  -12.010</td> <td> 0.000</td> <td>  -36.613</td> <td>  -26.337</td>
</tr>
<tr>
  <th>mpg</th>                <td>   -0.0201</td> <td>    0.002</td> <td>  -13.019</td> <td> 0.000</td> <td>   -0.023</td> <td>   -0.017</td>
</tr>
<tr>
  <th>year:engineSize</th>    <td>    9.5957</td> <td>    0.254</td> <td>   37.790</td> <td> 0.000</td> <td>    9.098</td> <td>   10.094</td>
</tr>
<tr>
  <th>year:mileage</th>       <td>    0.0154</td> <td>    0.001</td> <td>   11.816</td> <td> 0.000</td> <td>    0.013</td> <td>    0.018</td>
</tr>
<tr>
  <th>year:mpg</th>           <td>    0.0572</td> <td>    0.013</td> <td>    4.348</td> <td> 0.000</td> <td>    0.031</td> <td>    0.083</td>
</tr>
<tr>
  <th>engineSize:mileage</th> <td>   -0.1453</td> <td>    0.008</td> <td>  -18.070</td> <td> 0.000</td> <td>   -0.161</td> <td>   -0.130</td>
</tr>
<tr>
  <th>engineSize:mpg</th>     <td>  -98.9062</td> <td>   11.832</td> <td>   -8.359</td> <td> 0.000</td> <td> -122.102</td> <td>  -75.710</td>
</tr>
<tr>
  <th>mileage:mpg</th>        <td>    0.0011</td> <td>    0.000</td> <td>    2.432</td> <td> 0.015</td> <td>    0.000</td> <td>    0.002</td>
</tr>
<tr>
  <th>I(mileage ** 2)</th>    <td> 7.713e-06</td> <td> 3.75e-07</td> <td>   20.586</td> <td> 0.000</td> <td> 6.98e-06</td> <td> 8.45e-06</td>
</tr>
<tr>
  <th>I(mileage ** 3)</th>    <td>-1.867e-11</td> <td> 1.43e-12</td> <td>  -13.077</td> <td> 0.000</td> <td>-2.15e-11</td> <td>-1.59e-11</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Omnibus:</th>       <td>1830.457</td> <th>  Durbin-Watson:     </th> <td>   0.634</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>34927.811</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 1.276</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td>15.747</td>  <th>  Cond. No.          </th> <td>2.50e+18</td> 
</tr>
</tbody></table><br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 2.5e+18. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<div class="cell" data-execution_count="290">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(model.predict(test),test.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="290">
<pre><code>9026.775740000594</code></pre>
</div>
</div>
<p>Note the RMSE with GAM that includes regression splines for mileage is lesser than that of the linear regression model, indicating a better fit.</p>
</section>
<section id="mars-multivariate-adaptive-regression-splines" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="mars-multivariate-adaptive-regression-splines"><span class="header-section-number">2.5</span> MARS (Multivariate Adaptive Regression Splines)</h2>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>train[<span class="st">'mileage'</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>train[<span class="st">'price'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Earth()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Earth()</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyearth <span class="im">import</span> Earth</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mars-of-degree-1" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="mars-of-degree-1"><span class="header-section-number">2.5.1</span> MARS of degree 1</h3>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Earth(max_terms<span class="op">=</span><span class="dv">500</span>, max_degree<span class="op">=</span><span class="dv">1</span>) <span class="co"># note, terms in brackets are the hyperparameters </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>model.fit(X,y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:813: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  pruning_passer.run()
C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:1066: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  coef, resid = np.linalg.lstsq(B, weighted_y[:, i])[0:2]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Earth(max_degree=1, max_terms=500)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Earth Model
-------------------------------------
Basis Function  Pruned  Coefficient  
-------------------------------------
(Intercept)     No      -553155      
h(x0-22141)     Yes     None         
h(22141-x0)     Yes     None         
h(x0-3354)      No      -6.23571     
h(3354-x0)      Yes     None         
h(x0-15413)     No      -36.9613     
h(15413-x0)     No      38.167       
h(x0-106800)    Yes     None         
h(106800-x0)    No      0.221844     
h(x0-500)       No      170.039      
h(500-x0)       Yes     None         
h(x0-741)       Yes     None         
h(741-x0)       No      -54.5265     
h(x0-375)       No      -126.804     
h(375-x0)       Yes     None         
h(x0-2456)      Yes     None         
h(2456-x0)      No      7.04609      
-------------------------------------
MSE: 188429705.7549, GCV: 190035470.5664, RSQ: 0.2998, GRSQ: 0.2942</code></pre>
</div>
</div>
<p>Model equation: <span class="math display">\[-553155 -6.23(h(x0-3354)) -36.96(h(x0-15413) + .......... -7.04(h(2456-x0)\]</span></p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model.predict(test.mileage)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(pred,test.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>13650.2113154515</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x <span class="op">=</span> <span class="st">'mileage'</span>, y <span class="op">=</span> <span class="st">'price'</span>, data <span class="op">=</span> train, color <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x <span class="op">=</span> train.mileage, y <span class="op">=</span> model.predict(train.mileage), color <span class="op">=</span> <span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>&lt;AxesSubplot:xlabel='mileage', ylabel='price'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-40-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="mars-of-degree-2" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="mars-of-degree-2"><span class="header-section-number">2.5.2</span> MARS of degree 2</h3>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Earth(max_terms<span class="op">=</span><span class="dv">500</span>, max_degree<span class="op">=</span><span class="dv">2</span>) <span class="co"># note, terms in brackets are the hyperparameters </span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>model.fit(X,y)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Earth Model
-----------------------------------------------
Basis Function           Pruned  Coefficient   
-----------------------------------------------
(Intercept)              No      19369.7       
h(x0-22141)              Yes     None          
h(22141-x0)              Yes     None          
h(x0-7531)*h(22141-x0)   No      3.74934e-05   
h(7531-x0)*h(22141-x0)   No      -6.74252e-05  
x0*h(x0-22141)           No      -8.0703e-06   
h(x0-15012)              Yes     None          
h(15012-x0)              No      1.79813       
h(x0-26311)*h(x0-22141)  No      8.85097e-06   
h(26311-x0)*h(x0-22141)  Yes     None          
-----------------------------------------------
MSE: 189264421.5682, GCV: 190298913.1652, RSQ: 0.2967, GRSQ: 0.2932</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:813: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  pruning_passer.run()
C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:1066: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  coef, resid = np.linalg.lstsq(B, weighted_y[:, i])[0:2]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model.predict(test.mileage)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(pred,test.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>13590.995419204985</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x <span class="op">=</span> <span class="st">'mileage'</span>, y <span class="op">=</span> <span class="st">'price'</span>, data <span class="op">=</span> train, color <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x <span class="op">=</span> train.mileage, y <span class="op">=</span> model.predict(train.mileage), color <span class="op">=</span> <span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;AxesSubplot:xlabel='mileage', ylabel='price'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Lec2_Regression_splines_files/figure-html/cell-43-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>MARS provides a better fit than the splines that we used above. This is because MARS tunes the positions of the knots and considers interactions (also with tuned knots) to improve the model fit. Tuning of knots may improve the fit of splines as well.</p>
</section>
<section id="mars-including-categorical-variables" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="mars-including-categorical-variables"><span class="header-section-number">2.5.3</span> MARS including categorical variables</h3>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#A categorical variable can be turned to dummy variables to use the Earth package for fitting MARS model</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>train_cat <span class="op">=</span> pd.concat([train,pd.get_dummies(train.fuelType)],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>test_cat <span class="op">=</span> pd.concat([test,pd.get_dummies(test.fuelType)],axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>train_cat.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>carID</th>
      <th>brand</th>
      <th>model</th>
      <th>year</th>
      <th>transmission</th>
      <th>mileage</th>
      <th>fuelType</th>
      <th>tax</th>
      <th>mpg</th>
      <th>engineSize</th>
      <th>price</th>
      <th>Diesel</th>
      <th>Electric</th>
      <th>Hybrid</th>
      <th>Other</th>
      <th>Petrol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18473</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2020</td>
      <td>Semi-Auto</td>
      <td>11</td>
      <td>Diesel</td>
      <td>145</td>
      <td>53.3282</td>
      <td>3.0</td>
      <td>37980</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15064</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2019</td>
      <td>Semi-Auto</td>
      <td>10813</td>
      <td>Diesel</td>
      <td>145</td>
      <td>53.0430</td>
      <td>3.0</td>
      <td>33980</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18268</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2020</td>
      <td>Semi-Auto</td>
      <td>6</td>
      <td>Diesel</td>
      <td>145</td>
      <td>53.4379</td>
      <td>3.0</td>
      <td>36850</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>18480</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2017</td>
      <td>Semi-Auto</td>
      <td>18895</td>
      <td>Diesel</td>
      <td>145</td>
      <td>51.5140</td>
      <td>3.0</td>
      <td>25998</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>18492</td>
      <td>bmw</td>
      <td>6 Series</td>
      <td>2015</td>
      <td>Automatic</td>
      <td>62953</td>
      <td>Diesel</td>
      <td>160</td>
      <td>51.4903</td>
      <td>3.0</td>
      <td>18990</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> train_cat[[<span class="st">'mileage'</span>,<span class="st">'mpg'</span>,<span class="st">'engineSize'</span>,<span class="st">'year'</span>,<span class="st">'Diesel'</span>,<span class="st">'Electric'</span>,<span class="st">'Hybrid'</span>,<span class="st">'Petrol'</span>]]</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>Xtest <span class="op">=</span> test_cat[[<span class="st">'mileage'</span>,<span class="st">'mpg'</span>,<span class="st">'engineSize'</span>,<span class="st">'year'</span>,<span class="st">'Diesel'</span>,<span class="st">'Electric'</span>,<span class="st">'Hybrid'</span>,<span class="st">'Petrol'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Earth(max_terms<span class="op">=</span><span class="dv">500</span>, max_degree<span class="op">=</span><span class="dv">2</span>) <span class="co"># note, terms in brackets are the hyperparameters </span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>model.fit(X,y)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:813: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  pruning_passer.run()</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Earth Model
---------------------------------------------------------
Basis Function                      Pruned  Coefficient  
---------------------------------------------------------
(Intercept)                         No      2.17604e+06  
h(engineSize-5.5)                   No      9.80752e+06  
h(5.5-engineSize)                   No      1.92817e+06  
h(mileage-21050)                    No      18.687       
h(21050-mileage)                    No      -177.871     
h(mileage-21050)*h(5.5-engineSize)  Yes     None         
h(21050-mileage)*h(5.5-engineSize)  No      -0.224909    
year                                No      4126.41      
h(mpg-53.3495)                      No      344595       
h(53.3495-mpg)                      Yes     None         
Hybrid*h(5.5-engineSize)            No      6124.34      
h(mileage-21050)*year               No      -0.00930239  
h(21050-mileage)*year               No      0.0886455    
h(engineSize-5.5)*year              No      -4864.84     
h(5.5-engineSize)*year              No      -952.92      
h(mileage-1422)*h(53.3495-mpg)      No      -16.62       
h(1422-mileage)*h(53.3495-mpg)      No      16.4306      
Hybrid                              No      -89090.6     
h(mpg-21.1063)*h(53.3495-mpg)       Yes     None         
h(21.1063-mpg)*h(53.3495-mpg)       No      -8815.99     
h(mpg-23.4808)*h(5.5-engineSize)    No      -3649.97     
h(23.4808-mpg)*h(5.5-engineSize)    Yes     None         
h(mpg-20.5188)*year                 No      31.7341      
h(20.5188-mpg)*year                 Yes     None         
h(mpg-22.2566)*h(53.3495-mpg)       No      -52.2531     
h(22.2566-mpg)*h(53.3495-mpg)       No      7916.19      
h(mpg-22.6767)                      No      7.56432e+06  
h(22.6767-mpg)                      Yes     None         
h(mpg-23.9595)*h(mpg-22.6767)       Yes     None         
h(23.9595-mpg)*h(mpg-22.6767)       No      -63225.4     
h(mpg-21.4904)*h(22.6767-mpg)       No      -149055      
h(21.4904-mpg)*h(22.6767-mpg)       Yes     None         
h(mpg-21.1063)                      No      -887098      
h(21.1063-mpg)                      Yes     None         
h(mpg-29.5303)*h(mpg-22.6767)       No      -3028.87     
h(29.5303-mpg)*h(mpg-22.6767)       Yes     None         
h(mpg-28.0681)*h(5.5-engineSize)    No      3572.89      
h(28.0681-mpg)*h(5.5-engineSize)    Yes     None         
engineSize*h(5.5-engineSize)        No      -2952.65     
h(mpg-25.3175)*h(mpg-21.1063)       No      -332551      
h(25.3175-mpg)*h(mpg-21.1063)       No      324298       
Petrol*year                         No      -1.37031     
h(mpg-68.9279)*Hybrid               No      -4087.9      
h(68.9279-mpg)*Hybrid               Yes     None         
h(mpg-31.5043)*h(5.5-engineSize)    Yes     None         
h(31.5043-mpg)*h(5.5-engineSize)    No      3691.82      
h(mpg-32.7011)*h(5.5-engineSize)    Yes     None         
h(32.7011-mpg)*h(5.5-engineSize)    No      -2262.78     
h(mpg-44.9122)*h(mpg-22.6767)       No      335577       
h(44.9122-mpg)*h(mpg-22.6767)       No      -335623      
h(engineSize-5.5)*h(mpg-21.1063)    No      27815        
h(5.5-engineSize)*h(mpg-21.1063)    Yes     None         
h(mpg-78.1907)*Hybrid               Yes     None         
h(78.1907-mpg)*Hybrid               No      2221.49      
h(mpg-63.1632)*h(mpg-22.6767)       Yes     None         
h(63.1632-mpg)*h(mpg-22.6767)       No      21.0093      
Hybrid*h(mpg-53.3495)               No      4121.91      
h(mileage-22058)*h(53.3495-mpg)     No      16.6177      
h(22058-mileage)*h(53.3495-mpg)     No      -16.6044     
h(mpg-21.8985)                      Yes     None         
h(21.8985-mpg)                      No      371659       
---------------------------------------------------------
MSE: 45859836.5623, GCV: 47884649.3622, RSQ: 0.8296, GRSQ: 0.8221</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:1066: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  coef, resid = np.linalg.lstsq(B, weighted_y[:, i])[0:2]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model.predict(Xtest)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(pred,test2.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>7499.709075454322</code></pre>
</div>
</div>
<p>Let us compare the RMSE of a MARS model with <em>mileage, mpg, engineSize</em> and <em>year</em> with a linear regression model having the same predictors.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> train[[<span class="st">'mileage'</span>,<span class="st">'mpg'</span>,<span class="st">'engineSize'</span>,<span class="st">'year'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Earth(max_terms<span class="op">=</span><span class="dv">500</span>, max_degree<span class="op">=</span><span class="dv">2</span>) <span class="co"># note, terms in brackets are the hyperparameters </span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>model.fit(X,y)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:813: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  pruning_passer.run()</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Earth Model
----------------------------------------------------------
Basis Function                      Pruned  Coefficient   
----------------------------------------------------------
(Intercept)                         No      -8.13682e+06  
h(engineSize-5.5)                   No      9.53908e+06   
h(5.5-engineSize)                   Yes     None          
h(mileage-21050)                    No      23.4448       
h(21050-mileage)                    No      -215.861      
h(mileage-21050)*h(5.5-engineSize)  Yes     None          
h(21050-mileage)*h(5.5-engineSize)  No      -0.278562     
year                                No      4125.85       
h(mpg-53.3495)                      Yes     None          
h(53.3495-mpg)                      Yes     None          
h(mileage-21050)*year               No      -0.0116601    
h(21050-mileage)*year               No      0.107624      
h(mpg-53.2957)*h(5.5-engineSize)    No      -59801.3      
h(53.2957-mpg)*h(5.5-engineSize)    No      59950.5       
h(engineSize-5.5)*year              No      -4713.74      
h(5.5-engineSize)*year              No      -755.742      
h(mileage-1766)*h(53.3495-mpg)      No      -0.00337072   
h(1766-mileage)*h(53.3495-mpg)      No      -0.144905     
h(mpg-19.1277)*h(53.3495-mpg)       No      161.153       
h(19.1277-mpg)*h(53.3495-mpg)       Yes     None          
h(mpg-23.4808)*h(5.5-engineSize)    Yes     None          
h(23.4808-mpg)*h(5.5-engineSize)    Yes     None          
h(mpg-21.4971)*h(5.5-engineSize)    Yes     None          
h(21.4971-mpg)*h(5.5-engineSize)    Yes     None          
h(mpg-40.224)*h(5.5-engineSize)     Yes     None          
h(40.224-mpg)*h(5.5-engineSize)     No      298.139       
engineSize*h(5.5-engineSize)        No      -2553.17      
h(mpg-22.2566)                      Yes     None          
h(22.2566-mpg)                      No      29257.3       
h(mpg-20.7712)*h(22.2566-mpg)       No      143796        
h(20.7712-mpg)*h(22.2566-mpg)       No      -1249.17      
h(mpg-21.4971)*h(22.2566-mpg)       No      -315486       
h(21.4971-mpg)*h(22.2566-mpg)       Yes     None          
h(mpg-27.0995)*h(mpg-22.2566)       No      3855.71       
h(27.0995-mpg)*h(mpg-22.2566)       Yes     None          
h(mpg-29.3902)*year                 No      6.05449       
h(29.3902-mpg)*year                 No      -20.176       
h(mpg-28.0681)*h(5.5-engineSize)    No      59901.6       
h(28.0681-mpg)*h(5.5-engineSize)    No      -55502.2      
h(mpg-23.2962)*h(mpg-22.2566)       No      -56126        
h(23.2962-mpg)*h(mpg-22.2566)       No      73153.9       
h(mpg-69.0719)*h(mpg-53.3495)       Yes     None          
h(69.0719-mpg)*h(mpg-53.3495)       No      -124.847      
h(engineSize-5.5)*h(22.2566-mpg)    No      -20955.8      
h(5.5-engineSize)*h(22.2566-mpg)    No      -8336.23      
h(mpg-23.9595)*h(mpg-22.2566)       No      -62983        
h(23.9595-mpg)*h(mpg-22.2566)       Yes     None          
h(mpg-23.6406)*h(mpg-22.2566)       No      115253        
h(23.6406-mpg)*h(mpg-22.2566)       Yes     None          
h(mpg-56.1908)                      Yes     None          
h(56.1908-mpg)                      No      -2239.85      
h(mpg-29.7993)*h(53.3495-mpg)       No      -139.61       
h(29.7993-mpg)*h(53.3495-mpg)       No      788.756       
----------------------------------------------------------
MSE: 49704412.0771, GCV: 51526765.3943, RSQ: 0.8153, GRSQ: 0.8086</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\akl0407\Anaconda3\lib\site-packages\pyearth\earth.py:1066: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  coef, resid = np.linalg.lstsq(B, weighted_y[:, i])[0:2]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>Xtest <span class="op">=</span> test[[<span class="st">'mileage'</span>,<span class="st">'mpg'</span>,<span class="st">'engineSize'</span>,<span class="st">'year'</span>]]</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model.predict(Xtest)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(pred,test.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>7614.158359050244</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ols_object <span class="op">=</span> smf.ols(formula <span class="op">=</span> <span class="st">'price~(year+engineSize+mileage+mpg)**2'</span>, data <span class="op">=</span> train)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> ols_object.fit()</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model.predict(test)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(pred,test.price))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>8729.912066822455</code></pre>
</div>
</div>
<p>The RMSE for the MARS model is lesser than that of the linear regression model, as expected.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./L1_Scikit-learn.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to scikit-learn</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Assignment A.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Assignment A</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>